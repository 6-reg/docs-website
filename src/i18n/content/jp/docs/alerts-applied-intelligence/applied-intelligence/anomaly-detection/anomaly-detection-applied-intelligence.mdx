---
title: 応用インテリジェンスによる異常検出
tags:
  - Alerts and applied intelligence
  - Applied intelligence
  - Proactive detection
metaDescription: Learn how anomaly detection in New Relic notifies you of unusual app behavior. Get notified in Slack or set up a custom webhook.
translationType: machine
---

import anomalydashboard from 'images/anomaly-dashboard.png'

import anomalydetails from 'images/anomaly-details.png'

import anomalyslacknotifications from 'images/anomaly-slack-notifications.png'

import newRelicAlertsBaselineThresholds from 'images/new-relic-alerts-baseline-thresholds.png'

import iconAlertCritical from 'images/icon-alert-critical.png'

import iconAlertWarning from 'images/icon-alert-warning.png'

import alertsHowCustomAnomaliesWork from 'images/alerts_screenshot-full_how-custom-anomalies-work.png'

import alertsAnomaliesSetUpperandLowerRanges from 'images/alerts_screenshot-full_anomalies-set-upper-and-lower-ranges.png'

import alertsFacetedAnomaliesTwo from 'images/alerts_screenshot-full_faceted-anomalies-two.png'

import alertsFacetedAnomalies from 'images/alerts_screenshot-full_faceted-anomalies.png'

import alertsConfigureYourAnomalyThresholds from 'images/alerts_screenshot-full_configure-your-anomaly-thresholds.png'

応用インテリジェンスの異常検出により、New Relic はチームに異常な行動を即座に警告します。New Relic は AI を使用してアプリケーションを常に監視します。この情報を使用して、アプリケーションのベースラインまたは期待されるパフォーマンスを判断します。行動がベースラインから逸脱するたびに、すぐにそれを認識してチームに警告するので、エラーに迅速かつ効率的に対処できます。

<img
  title="A screenshot of the anomaly dashboard in the New Relic UI"
  alt="A screenshot of the anomaly dashboard in the New Relic UI"
  src={anomalydashboard}
/>

<figcaption>
  チームがシステムの異常な動作を監視できる異常ダッシュボード。  

</figcaption>

## アノマリーの使用方法 [#anomalies-in-use]

New Relic の開発者は、アプリケーションの状態を監視することがいかに重要かを知っています。お客様が必要なときにいつでも必要なデータにアクセスできるようにしたいので、システムのパフォーマンスに異常値がある場合はチームに警告する必要があります。New Relic の異常検出は、適用されたインテリジェンスを使用して、スループット、エラー率、レイテンシの 3 つの重要なゴールデン シグナルを監視します。異常検出により、開発者はこれらの指標のベースライン パフォーマンスを監視します。

ある午後、応答時間が急上昇し、顧客がホームページにアクセスするのに通常よりも時間がかかったとします。異常検出は、レイテンシ メトリック データがベースラインから逸脱しているため、この異常な動作にフラグを立てます。これは必ずしも問題があることを意味するわけではなく、AI がシステムに通常とは異なる何かを登録したことを示しているだけであり、詳しく調べる必要があります。

この異常な動作をいくつかの方法で監視しています。まず、私たちのチームは異常ダッシュボードを使用して、何がいつ変更されたかを確認します。

<img
  title="A screenshot of anomaly details in the New Relic UI"
  alt="A screenshot of anomaly details in the New Relic UI"
  src={anomalydetails}
/>

<figcaption>
  システムのパフォーマンスの異常を調査して、受け取ったエラーとその理由をよりよく理解します。  

</figcaption>

また、Slack で配信される異常の通知を設定し、必要なときにメッセージを配信する Webhook を設定しました。

<img
  title="A screenshot of the slack notification set up for anomalies in the New Relic UI"
  alt="A screenshot of the slack notification set up for anomalies in the New Relic UI"
  src={anomalyslacknotifications}
/>

<figcaption>
  New Relic UI で異常の Slack または Webhook 通知を設定する方法。  

</figcaption>

これらのイベントは、クエリ、カスタム ダッシュボードの作成、アラートにも使用できます。異常検出構成 (関心のあるアプリのグループ) を設定したら、この構成をソースとして追加できます。その後、異常はインシデント インテリジェンスを介して他のデータ ソースと自動的に関連付けられます。

## 異常検出には、自動とカスタムの 2 種類があります。

[自動異常](/docs/alerts-applied-intelligence/applied-intelligence/anomaly-detection/anomaly-detection-applied-intelligence#automatic-anomalies)は、チームが APM で監視されているアプリケーションの異常な動作について学習するための最も効率的な方法です。自動異常検出は、チームが実装できるハンズオフ ツールであり、アプリケーションの動作がベースラインから逸脱した瞬間に通知されるようにします。自動異常を使用して問題の原因を特定し、適切な手順を実行してシステムを再びスムーズに稼働させることができます。

[カスタム異常](/docs/alerts-applied-intelligence/applied-intelligence/anomaly-detection/anomaly-detection-applied-intelligence#custom-anomalies)により、チームの構成可能性が向上します。カスタム異常により、チームは NQRL の状態を警告し、しきい値を調整および最適化することができます。カスタム異常も静的アラートと同じ高度な調整設定を使用するため、チームは自分にとって重要な異常インシデントのみを確認できます。

## 自動異常 [#automatic-anomalies]

自動異常検出では、次の方法を使用してアプリ データの異常を検出します。

1. 異常検出は、APM エージェントによって報告されたメトリック データを監視し、典型的なアプリケーション ダイナミクスのモデルを構築し、主要なゴールデン シグナル (スループット、応答時間、およびエラー) に焦点を当てます。
2. これらのゴールデンシグナルの一つが異常な動作を示した場合、システムはそれにフラグを立て、正常な動作への回復を追跡します。
3. お客様のデータの変化に適応し、新しいデータに基づいてモデルを継続的に更新していきます。

**自動的にオン**: デフォルトでは、異常検出はすべての APM アプリケーションを監視します。ユーザーがアクションを行う必要はありません。異常が検出されると、さまざまなアクティビティ ストリームに自動的に表示され、適用されたインテリジェンスの異常がフィードされ、NRQL を介してクエリを実行できるようになります。

**Receiving notifications:** スループット、エラーレート、または応答時間の異常な変化を検出したときに、通知を送信します。通知は、選択したSlackチャンネルに送信されるか、webhookで送信されます。異常が正常に戻ったときには、回復メッセージが送信されます。通知を受け取りたくない場合でも、 [NRQLクエリ](#anomaly-events) を通じてデータにアクセスすることができます。

**異常分析:**異常ごとに、異常分析ページへのリンクを Slack に提供します。このページは、異常に対する自動洞察を生成します。このページは、最近の異常を一覧表示する異常タブからも利用できます。このページでは、既存の APM と異常検出データを使用して、異常の原因に関する説明を提供します。

**アクティビティストリーム：** New Relicホームページ、APM概要ページ、Lookout、Explorerなどのさまざまなアクティビティストリーム内に、APMで監視されているアプリケーションからの関連する異常が表示されます。アクティビティストリーム内の異常イベントのいずれかをクリックすると、その異常の分析ページが表示されます。

アプリケーションは常に異常を発生させるわけではないので、検出されないのが普通の場合もあります。

### 要件 [#requirements]

New Relic の異常検出を使用するには、次のものが必要です。

* 少なくとも1つのアプリケーションにAPMエージェントがインストールされていること。
* Slackで通知を受け取るためには、IT管理者に依頼して、Slackのワークスペース [にNew Relicのアプリケーションをインストールしてもらう必要があります。](https://slack.com/help/articles/202035138-Add-an-app-to-your-workspace)
* [](https://slack.com/help/articles/202035138-Add-an-app-to-your-workspace)

[](https://slack.com/help/articles/202035138-Add-an-app-to-your-workspace)

[データ制限については、 ](https://slack.com/help/articles/202035138-Add-an-app-to-your-workspace)[Data limits](#data-limits) を参照してください。

### 異常検出の通知を設定する [#set-up]

自動異常検出は、追加料金なしで自動的に有効になります。通知を受信したり、インシデント インテリジェンスのソースとして追加できる構成 (アプリのグループ) を用意したりするには、異常検出構成を作成する必要があります。異常検出 UI で構成を作成できます。

1. **[one.newrelic.com](https://one.newrelic.com/all-capabilities)**から、\[**アラートと AI** ] をクリックします。

2. \[**異常検出**] で、\[**設定]**をクリックします。

3. クリック **Add a configuration**.

4. 以下の情報をフォームに入力してください。

   * アカウント内の他の構成と簡単に区別できるように、構成の名前を決めてください。
   * アカウントを選択します。
   * 最大 1,000 件のアプリケーションを選択します。スループットの低い特定のアプリケーションは、少量のデータ変動により敏感になる可能性があるため、異常検出の対象として適していない可能性があることに注意してください。

5. オプション：異常を監視したいゴールデンシグナルを選択します。

6. オプション：[インシデントインテリジェンスに接続し](#add-source)ます。

<CollapserGroup>
  <Collapser
    id="slack-set-up"
    title="Slackへのセットアップ"
  >
    Slack で異常検出を使用するには:

    1. Select **Slack**.

    2. 通知を受信するSlackチャネルを選択します。既存のパブリックチャネルまたはプライベートチャネルを選択できます。これにより、ワークフローは、適用されたインテリジェンスSlackアプリケーションを選択したチャネルに追加するように求められます。新しいチャネルを作成するには、最初にSlackで直接作成します。 <Callout variant="tip">Slackチャネルの割り当て中にエラーが発生した場合は、New RelicAISlackアプリケーションが[Slackワークスペースに追加されていることを確認してください](https://slack.com/help/articles/202035138-Add-an-app-to-your-workspace)。</Callout>

    3. 設定を保存します。

       各構成のアプリケーションは、構成表で構成を選択することで、いつでも変更することができます。
  </Collapser>

  <Collapser
    id="configure-webhooks"
    title="Webhooksのためのセットアップ"
  >
    Webhook で異常検出を使用するには:

    1. **Webhook** を選択します。

    2. 以下の情報をフォームに入力してください。

       * WebhookのURLを入力してください。
       * オプションでカスタムヘッダーを用意
       * カスタムペイロードを編集するか、デフォルトのペイロードを使用するかを選択します。

    3. 設定を保存します。

       各構成のアプリケーションは、構成表で構成を選択することで、いつでも変更することができます。
  </Collapser>

  <Collapser
    id="no-notifications"
    title="通知なしで設定する"
  >
    通知を受け取る必要がない場合に異常検出を使用するには:

    1. 選択 **通知しない**.

    2. 設定を保存します。

       各構成のアプリケーションは、構成表で構成を選択することで、いつでも変更することができます。
  </Collapser>
</CollapserGroup>

### 通知のミュート（Slackのみ） [#mute-notifications]

Slackでは、特定のアプリケーションからの検出音を一時的または恒久的にミュートすることができます。また、チャンネル全体を一時的にミュートにすることもできます。この機能は、インシデントが発生した場合や、チャンネルを中断させたくない場合に便利です。

Slack でミュートするには、\[**このアプリの警告**を**ミュートする] または \[すべての警告**をミュートする] を選択し、期間を選択します。ミュート期間が終了したら、検出の通知の送信を再開します。

アプリケーションをミュートすると、構成から永久に削除されます。再度追加するには、 **[one.newrelic.com](https://one.newrelic.com/all-capabilities) > Alerts & AI > Anomaly detection**に移動し、編集する構成を選択します。

異常検出通知をミュートしても、アラートには影響しません。

### 異常検出 Slack メッセージを使用する [#feedback]

それぞれの異常メッセージには、問題の詳細を把握し、トラブルシューティングを開始するために使用できるいくつかの重要な情報が含まれています。

* NewRelicUIにあるアプリケーション名とその詳細情報へのリンク。
* 異常が発生しているメトリックと、NewRelicUIの詳細へのリンク。
* メトリクスの経時変化をグラフ化し、異常の挙動や程度を視覚的に理解することができます。
* 適用されたインテリジェンスの分析ページに移動する\[**分析**]ボタン。異常、上流または下流で検出された異常、およびその他の関連する信号に固有の主要な属性を識別します。

異常が正常に戻った時点で、フィードバックを提供するためのオプションを含む回復通知を送信します。お客様からのフィードバックは、開発チームが検出品質を向上させるための情報となります。スループットの異常に関するフィードバックの場合、より適切なモデルに適合させるために、フィードバックに基づいて毎時間評価が実行されます。私たちがお手伝いした場合は、 **はい** または **いいえ** を選択してください。

### 異常タブ [#anomaly-overview]

Slackやwebhookを介して情報を提供する異常の通知に加えて、 [Alerts& AI Overviewページ](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/alerts-ai-overview-page) の [Anomaliesタブ](/docs/alerts-applied-intelligence/new-relic-alerts/get-started/alerts-ai-overview-page#anomalies) を介して、自分の環境の異常に関する詳細な情報を見ることができます。そのタブには、選択されたアカウントのすべての構成からの最近のすべての異常のリストが表示され、異常を選択して詳細な分析を行うことができます。

### 異常の可視化設定 [#visibility-settings]

異常は、さまざまなNewRelicアクティビティストリームと適用されたインテリジェンス異常フィードに表示されます。異常の可視性設定を使用して表示内容をカスタマイズできます（たとえば、アクティビティストリームでスループットの異常を非表示にし、異常フィードに保持します）。

これらの設定を見つけるには、\[**アラートと AI** ] の \[**異常検出**] で、\[**設定]**をクリックします。

これらの設定を使用する際の注意点

* これらの設定は、ユーザーレベルで適用されます。あなたが行った変更は、あなたの組織内の他のユーザーには影響しません。
* これらの設定にかかわらず、異常値は報告され、 [NRQL クエリで利用可能です。](/docs/query-your-data/nrql-new-relic-query-language/get-started/introduction-nrql-new-relics-query-language) 。

これらのUIセクションの詳細。

* **AI overview and anomalies tab**: AI overview and anomalies tab の設定で、異常値を非表示にします。また、これらのビューに固有のフィルターも使用できますのでご注意ください。
* **グローバルアクティビティストリーム**：グローバルアクティビティストリームセクションを使用して、New Relicホームページ、APMサマリー、LookoutなどのさまざまなNewRelicアクティビティストリームに表示される異常をカスタマイズします。
* **Anomaly types**: 特定のタイプの異常を隠すには、ここのチェックボックスを使用します。例えば、 **Webスループット** と **Non-Webスループット** 異常のチェックを外すと、これらのタイプの異常は、アクティビティストリームとAI概要および異常タブの両方から非表示になります。(ただし、これらの異常はレポートされ、クエリで利用可能です。)

### アノマリーデータの照会 [#anomaly-events]

[NRQL](/docs/query-your-data/nrql-new-relic-query-language/get-started/introduction-nrql-new-relics-query-language)を使用して、 `NrAiAnomaly`イベントを使用して異常検出データのクエリとグラフ化を行うことができます。例えば：

`FROM NrAiAnomaly SELECT *`

<Callout variant="important">
  このデータは、以前に`ProactiveDetection`イベントに添付されています。このイベントは2021年4月7日に非推奨になります。カスタムグラフで`ProactiveDetection`を使用する場合は、それらのクエリを`NrAiAnomaly`を使用するように変換する必要があります。
</Callout>

このイベントに付随する重要な属性は以下の通りです。

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `closeTime`  
        _タイムスタンプ_
      </td>

      <td>
        異常が終了した時刻。例： `1615304100000` 。
      </td>
    </tr>

    <tr>
      <td>
        `configurationType`  
        _ストリング_
      </td>

      <td>
        イベントを監視する構成のタイプ。少なくとも1つの構成がエンティティを監視している場合、これは`configuration`に設定されます。それ以外の場合は、 `automatic`に設定されます。
      </td>
    </tr>

    <tr>
      <td>
        `entity.accountId`  
        _番号_
      </td>

      <td>
        エンティティが所属するNew RelicアカウントID。
      </td>
    </tr>

    <tr>
      <td>
        `entity.domain`  
        _番号_
      </td>

      <td>
        エンティティのドメイン（現在は`APM`のみですが、将来の機能で変更されます）。
      </td>
    </tr>

    <tr>
      <td>
        `entity.guid`  
        _ストリング_
      </td>

      <td>
        エンティティのGUID。これは、NerdGraphを介してエンティティに関するデータを識別および取得するために使用されます。 `entityGuid`と同じです。
      </td>
    </tr>

    <tr>
      <td>
        `entityGuid`  
        _ストリング_
      </td>

      <td>
        エンティティのGUID。これは、NerdGraphを介してエンティティに関するデータを識別および取得するために使用されます。 `entity.guid`と同じです。
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`  
        _ストリング_
      </td>

      <td>
        データが異常であると判断されたエンティティの名前。 `entityName`と同じです。例： `Laura's coffee service` 。
      </td>
    </tr>

    <tr>
      <td>
        `entityName`  
        _ストリング_
      </td>

      <td>
        データが異常であると判断されたエンティティの名前。 `entity.name`と同じです。
      </td>
    </tr>

    <tr>
      <td>
        `entity.type`  
        _ストリング_
      </td>

      <td>
        エンティティのタイプ（現在は`APPLICATION`のみですが、将来の機能で変更されます）。
      </td>
    </tr>

    <tr>
      <td>
        `evaluationType`  
        _ストリング_
      </td>

      <td>
        これは常に`anomaly`です。
      </td>
    </tr>

    <tr>
      <td>
        `event`  
        _ストリング_
      </td>

      <td>
        異常データの始まり（ `open` ）か終わり（ `close` ）かを示します。
      </td>
    </tr>

    <tr>
      <td>
        `openTime`  
        _タイムスタンプ_
      </td>

      <td>
        異常が開いた時間。例： `1615303740000` 。
      </td>
    </tr>

    <tr>
      <td>
        `signalType`  
        _ストリング_
      </td>

      <td>
        分析されたデータのタイプ。たとえば、 `error_rate`または`response_time.non_web` 。
      </td>
    </tr>

    <tr>
      <td>
        `timestamp`  
        _タイムスタンプ_
      </td>

      <td>
        イベントが書き込まれた時間です。
      </td>
    </tr>

    <tr>
      <td>
        `title`  
        _ストリング_
      </td>

      <td>
        異常の説明。例： `Error rate was much higher than normal` 。
      </td>
    </tr>
  </tbody>
</table>

### インシデントインテリジェンスのソースとして異常を追加する [#add-source]

インシデント インテリジェンスを異常検出と統合することで、コンテキストと相関関係を取得できます。インシデント インテリジェンスでこれを行う方法については、「 [ソースの構成](/docs/alerts-applied-intelligence/applied-intelligence/incident-intelligence/get-started-incident-intelligence/#1-configure-sources)」を参照してください。

構成内から\[**インシデントインテリジェンスに接続]を**選択することもできます。

### Webhookのペイロードと例 [#webhook]

自動異常検出は、イベント本文を HTTPS POST 経由で JSON 形式で送信します。システムは、エンドポイントが正常な HTTP コード (2xx) を返すことを期待しています。Webhook を使用して自動異常検出を構成する場合は、Webhook 本文の形式と JSON スキーマの例を使用してください。

<table>
  <thead>
    <tr>
      <th style={{ width: "200px" }}>
        属性
      </th>

      <th>
        説明
      </th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>
        `category`  
        _列挙型_
      </td>

      <td>
        分析対象となったデータのカテゴリー。

        カテゴリーには、ウェブ・スループット、非ウェブ・スループット、ウェブ・トランザクション、非ウェブ・トランザクション、エラー・クラスがあります。
      </td>
    </tr>

    <tr>
      <td>
        `data`  
        _リスト_
      </td>

      <td>
        検知に至るまでの時系列データです。
      </td>
    </tr>

    <tr>
      <td>
        `data[].timestamp`  
        _番号_
      </td>

      <td>
        データポイントのタイムスタンプ（Unix エポックからの [ミリ秒）](https://currentmillis.com/) 。例：1584366819000
      </td>
    </tr>

    <tr>
      <td>
        `data[].unit`  
        _ストリング_
      </td>

      <td>
        データポイントの値を表す単位。

        データ単位には、 `count` 、 `milliseconds` 、および`error_rate`が含まれます。
      </td>
    </tr>

    <tr>
      <td>
        `data[].value`  
        _番号_
      </td>

      <td>
        データポイントの値です。例：1.52
      </td>
    </tr>

    <tr>
      <td>
        `detectionType`  
        _列挙型_
      </td>

      <td>
        分析されたデータのタイプ。タイプには、 `latency` 、 `throughput` 、および`error_rate`が含まれます。
      </td>
    </tr>

    <tr>
      <td>
        `entity`  
        _物体_
      </td>

      <td>
        異常なデータを報告した企業。
      </td>
    </tr>

    <tr>
      <td>
        `entity.accountId`  
        _番号_
      </td>

      <td>
        エンティティのアカウントのIDです。
      </td>
    </tr>

    <tr>
      <td>
        `entity.domain`  
        _列挙型_
      </td>

      <td>
        エンティティのドメインです。例APMです。
      </td>
    </tr>

    <tr>
      <td>
        `entity.domainId`  
        _ストリング_
      </td>

      <td>
        ドメイン内のエンティティを一意に識別するためのID。
      </td>
    </tr>

    <tr>
      <td>
        `entity.guid`  
        _ストリング_
      </td>

      <td>
        すべての製品においてエンティティを一意に識別するために使用されるguidです。
      </td>
    </tr>

    <tr>
      <td>
        `entity.name`  
        _ストリング_
      </td>

      <td>
        エンティティの名前。例： `Laura’s coffee service`
      </td>
    </tr>

    <tr>
      <td>
        `entity.link`  
        _ストリング_
      </td>

      <td>
        エンティティを表示するためのリンクです。例

        ```
        https://rpm.newrelic.com/accounts/<var>YOUR_ACCOUNT_ID</var>/applications/987654321”
        ```
      </td>
    </tr>

    <tr>
      <td>
        `severity`  
        _列挙型_
      </td>

      <td>
        `NORMAL` 、 `WARNING` 、または`CRITICAL`を含む、異常な変更がどのように発生したかの説明。
      </td>
    </tr>

    <tr>
      <td>
        `version`  
        _ストリング_
      </td>

      <td>
        提供されるデータを説明するために使用されるバージョン。

        例：v1
      </td>
    </tr>

    <tr>
      <td>
        `viewChartImageUrl`  
        _ストリング_
      </td>

      <td>
        異常データのチャートを示す画像。
      </td>
    </tr>

    <tr>
      <td>
        `anomalyzerUrl`  
        _ストリング_
      </td>

      <td>
        NewRelicの異常を分析するために開くことができるURL。
      </td>
    </tr>
  </tbody>
</table>

<CollapserGroup>
  <Collapser
    id="json-example-schema"
    title="JSONスキーマの例"
  >
    適用されたインテリジェンスは、HTTPSPOSTを介してJSON形式でイベント本文を送信します。システムは、エンドポイントが成功したHTTPコード（2xx）を返すことを期待しています。

    テンプレートです。

    ```
    {
      "version": "{{version}}", 
      "entity": {
        "type": "{{entity.type}}",
        "name": "{{entity.name}}",
        "link": "{{entity.link}}",
        "entityGuid": "{{entity.entityGuid}}",
        "domainId": "{{entity.domainId}}",
        "domain": "{{entity.domain}}",
        "accountId": {{entity.accountId}}
      },
      "detectionType": "{{detectionType}}",
      "category": "{{category}}",
      "data": [{{#each data}}
        {
          "value": {{value}},
          "unit": "{{unit}}",
          "timestamp": {{timestamp}}
        }
        {{#unless @last}},{{/unless}}
      {{/each}}],
      "viewChartImageUrl": "{{viewChartImageUrl}}",  
      "anomalyzerUrl": "{{anomalyzerUrl}}"
    }
    ```

    サンプルペイロード。

    ```
    {
      "version": "v1",
      "entity": {
        "type": "APPLICATION",
        "name": "<var>My Application</var>",
        "link": "https://rpm.newrelic.com/accounts/<var>ACCOUNT_ID</var>/applications/123",
        "entityGuid": "foo",
        "domainId": "123",
        "domain": "APM",
        "accountId": <var>YOUR_ACCOUNT_ID</var>
      },
      "detectionType": "metric",
      "category": "web throughput",
      "data": [ {
        "value": "100",
        "unit": "count",
        "timestamp": 1637260259819
      }, {
        "value": "99",
        "unit": "count",
        "timestamp": 1637260319819
      }, {
        "value": "0",
        "unit": "count",
        "timestamp": 1637260379819
      } ],
      "viewChartImageUrl": "https://www.example.com/image/8353cf2c-945c-48e8-99de-e903f033a881?height=200&width=400&show_timezone=true",
      "anomalyzerUrl": "https://www.example.com/anomalyzerUrlExample"
    }
    ```
  </Collapser>
</CollapserGroup>

### データ制限

[要件](#requirements) に加えて、データ制限があります。

* 監視対象のAPMアプリケーション：構成ごとに1,000個まで
* Slackの設定：1アカウントにつき200個まで
* Webhook構成：1アカウントにつき200個まで
* 通知のない設定：1アカウントにつき200件まで

## カスタム異常 [#custom-anomalies]

まず、条件を作成する必要があります。**[one.newrelic.com](https://one.newrelic.com/all-capabilities) > Alerts & AI > Policies > (ポリシーの作成または選択) > Create alert condition**に移動します。APM、Browser、または NRQL 条件を選択できます。

次に、アラート条件のしきい値タイプとして異常を選択する必要があります。

このしきい値は、データの値の将来の動作を予測します。 .この予測は、異常状態 UI のプレビュー グラフに黒い点線として表示されます。

<img
  title="How custom anomalies work"
  alt="A screenshot demonstrating active custom anomalies"
  src={alertsHowCustomAnomaliesWork}
/>

### 異常しきい値の構成

しきい値タイプに「異常」を選択したら、しきい値を設定する必要があります。これにより、通知を受ける基準が設定されます。

これを行うには、次のことが必要です。

* 条件が上方の違反、下方の違反、または両方をチェックするかどうかを設定する。
* インシデントをトリガーする動作を設定します (例: 「5 分以上逸脱する」)
* スライド バーを調整して違反を増やしたり減らしたりして、データ ソースの変動に対する条件の感度を調整します。このバーは、通知が必要な予測からの標準偏差の数を計算します。

<img
  title="Custom anomaly configuration"
  alt="A screenshot demonstrating how to configure custom anomalies"
  src={alertsConfigureYourAnomalyThresholds}
/>

データが予測された「正常」な挙動から逸脱し、選択した基準を満たすと、通知が送信されます。

異常の閾値を設定する際のポイント：

* [異常の方向](#upper-lower)を設定する際に、異常の上または下で発生する違反を監視するようにします。

* プレビューチャートは、表示データの[2日もしくは7日](#days)のいずれかに設定します。（[NRQLアラート条件](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries)には適用されません）。

* スライダーバーを使用して

  <img title="Alerts v3: Critical alert icon" alt="icon-alert-critical.png" src={iconAlertCritical}>を調整しますプレビューチャートに異常の周囲のライトグレーの領域として表される</img>

  **クリティカル**閾値の感度を調整します。異常の周囲の帯域が狭いほど、感度が高くなり、より多くの違反が生成されます。

* オプション:

  <img title="Alerts v3: Warning alert icon" alt="icon-alert-warning.png" src={iconAlertWarning}>を作成できます</img>

  [**警告**閾値](/docs/alerts/new-relic-alerts/defining-conditions/set-thresholds-alert-condition#threshold-levels)を作成できます（異常の周囲のダークグレーの領域）。

* NRQLアラートに関しては、[認められているNRQLクエリの種類](/docs/alerts/new-relic-alerts/defining-conditions/create-alert-conditions-nrql-queries#threshold-types)。

* アラート条件が複数のアプリケーションに適用されている場合は、チャートの上のドロップダウンから使用するメトリクスを選択できます。（NRQLアラート条件には適用されません）。

### ファセットの異常状態 [#anomaly-facets]

異常条件に対してファセットNRQLクエリを実行すると、単一の異常に結果を絞り込むことができます。

<img
  title="Faceted anomalies"
  alt="A screenshot depicting faceted anomalies"
  src={alertsFacetedAnomalies}
/>

単一の時系列には、異常、閾値バンド、1つ以上の違反領域（存在する場合）が表示されます。

<img
  title="Configured faceted anomalies"
  alt="A screenshot depicting a deeper dive into facted anomalies "
  src={alertsFacetedAnomaliesTwo}
/>

### 異常の方向: 上限または下限の範囲を選択します

予測値を上回る (「上限」) か、予測値を下回る (「下限」) か、または上回るか下回るかを条件に違反させるかどうかを選択できます。これらは、予測方向セレクターで選択します。

使用例：

* エラー率のようなデータ ソースには上限設定を使用する場合があります。これは、通常、データ ソースが上昇する場合のみ考慮し、下降する場合は考慮しないためです。
* スループットのようなデータ ソースには \[Lower] 設定を使用できます。これは、急激な上昇変動が非常に一般的であるためですが、急激な大幅な下降は問題の兆候である可能性があるためです。

さまざまな異常方向の設定で、データの大きな変動がどのように処理されるかの例を次に示します。赤い領域は違反を表します

<img
  title="A screenshot of anomaly details in the New Relic UI"
  alt="A screenshot demonstrating how to select upper and lower ranges for anomalies"
  src={alertsAnomaliesSetUpperandLowerRanges}
/>

### 予測値の計算に関するルール

予測を計算するアルゴリズムは数学的に複雑です。その予測能力を支配する主要なルールのいくつかを次に示します。

* **データ**の経過時間 最初の作成では、データの可用性と予測の種類に応じて、1 ～ 4 週間のデータを使用して予測が計算されます。作成後、アルゴリズムは長期間にわたる継続的なデータの変動を考慮しますが、より新しいデータにはより大きな重みが与えられます。短期間しか存在しなかったデータの場合、予測値は大きく変動する可能性が高く、あまり正確ではありません。これは、通常の値と動作を判断するのに十分なデータがまだないためです。データの履歴が多いほど、予測としきい値がより正確になります。
* **データの一貫**性一貫した範囲内にとどまっている、またはゆっくりと着実に傾向を示すメトリック値の場合、より予測可能な動作は、予測の周りでしきい値が厳しくなることを意味します。より多様で予測不可能なデータは、より緩い (より広い) しきい値を持ちます。
* **定期**的な変動 1 週間よりも短い周期的な変動 (毎週水曜日の午後 1 時の展開や夜間のレポートなど) の場合、予測アルゴリズムはこれらの周期的な変動を探し、それらに適応しようとします。